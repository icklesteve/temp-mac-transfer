name: Do Not Merge

on:
  pull_request:
    types: [labeled, unlabeled, synchronize, opened, reopened]

jobs:
  prevent-merge-new-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Get PR labels
        id: get-labels
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const pr = context.payload.pull_request;
            const labels = await github.rest.issues.listLabelsOnIssue({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: pr.number
            });
            const labelNames = labels.data.map(l => l.name);
            console.log("Labels on PR #" + pr.number + ":", labelNames);
            return labelNames;

      - name: Fail if 'New PR' label exists
        if: contains(steps.get-labels.outputs.result, 'New PR')
        run: |
          echo "::error::‚ùå This pull request is labeled 'New PR' and cannot be merged."
          exit 1
