name: Do Not Merge

on:
  workflow_call:
    inputs:
      pr_number:
        required: true
        type: number

jobs:
  prevent-merge-new-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Get PR labels
        id: get-labels
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const pr_number = ${{ inputs.pr_number }};
            const labels = await github.rest.issues.listLabelsOnIssue({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: pr_number
            });
            const labelNames = labels.data.map(l => l.name);
            console.log("Labels on PR #" + pr_number + ":", labelNames);
            return labelNames;

      - name: Fail if 'New PR' label exists
        if: contains(steps.get-labels.outputs.result, 'New PR')
        run: |
          echo "::error::‚ùå This pull request is labeled 'New PR' and cannot be merged."
          exit 1
